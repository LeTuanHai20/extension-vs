"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const r=require("vscode"),ut=require("net"),t=require("vscode"),ht=require("./debugger");let lt=!1;function at(){lt=!0,r.commands.executeCommand("workbench.action.debug.start")}exports.startDebuggingAndStopOnEntry=at;class gt{constructor(e){this.languageServer=e,this.q=null}resolveDebugConfiguration(e,s,i){if(!s.type&&!s.request&&!s.name){const e=r.window.activeTextEditor;e&&"php"===e.document.languageId&&(s.name="Launch current script in console",s.type="php",s.request="launch",s.program="${file}",s.cwd="${fileDirname}")}return this.q&&this.q.close(),t.commands.executeCommand("workbench.debug.action.toggleRepl"),this.q=ut.createServer(t=>{const s=new ht.PhpDebugSession(e.uri.fsPath,this.languageServer);s.setRunAsServer(!0),s.start(t,t),t.on("close",e=>{this.q=null})}).listen(0),s.debugServer=this.q.address().port,lt&&(s.stopOnEntry=!0,lt=!1),s}dispose(){this.q&&this.q.close()}}exports.PhpDebugConfigurationProvider=gt;