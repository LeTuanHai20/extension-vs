"use strict";var e=this&&this.t||function(t,e,i,s){return new(i||(i=Promise))(function(n,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function h(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,h)}c((s=s.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("vscode-debugadapter"),Ut=require("net"),Nt=require("./connection"),Vt=require("moment"),Wt=require("url"),Zt=require("child_process"),Ze=require("path"),Qt=require("util"),Yt=require("fs"),ti=require("./terminal"),ei=require("./paths"),ii=require("minimatch"),t=require("vscode"),S=require("path"),D=require("../telemetry"),si=require("../extension"),k=require("../utils"),ni=require("./dbgpProxyHandler"),w=require("os");if(process.env.VSCODE_NLS_CONFIG)try{Vt.locale(JSON.parse(process.env.VSCODE_NLS_CONFIG).locale)}catch(t){}function ri(t){let e;return t.hasChildren||"array"===t.type||"object"===t.type?e="array"===t.type?"array("+(t.hasChildren?t.numberOfChildren:0)+")":"object"===t.type&&t.class?t.class:t.type:(e=t.value||"string"===t.type?t.value:t.type,"string"===t.type?e='"'+e+'"':"bool"===t.type&&(e=!!parseInt(e)+"")),e}class oi extends r.DebugSession{constructor(t,e){super(),this.workspaceFolder=t,this.languageServer=e,this.tt=new Map,this.et=new Set,this.it=1,this.st=new Map,this.nt=1,this.rt=new Map,this.ot=new Map,this.ht=1,this.ct=new Map,this.at=new Map,this.dt=new Map,this.ut=new Map,this.lt=new Map,this.vt=new Map,this.EnvName="$_ENV",this.ServerName="$_SERVER",this.GlobalsName="$GLOBALS",this.RequestName="$_REQUEST",this.GetName="$_GET",this.PostName="$_POST",this.CookieName="$_COOKIE",this.HttpRawPostDataName="$HTTP_RAW_POST_DATA",this.FilesName="$_FILES",this.SessionName="$_SESSION",this.setDebuggerColumnsStartAt1(!0),this.setDebuggerLinesStartAt1(!0),this.setDebuggerPathFormat("uri")}initializeRequest(t,e){t.body={supportsConfigurationDoneRequest:!0,supportsEvaluateForHovers:!0,supportsConditionalBreakpoints:!0,supportsFunctionBreakpoints:!0,exceptionBreakpointFilters:[{filter:"Notice",label:"Notices"},{filter:"Warning",label:"Warnings"},{filter:"Error",label:"Errors"},{filter:"Exception",label:"Exceptions"},{filter:"*",label:"Everything",default:!0}],supportsSetVariable:!0,supportsLogPoints:!0},this.sendResponse(t)}attachRequest(t,e){this.sendErrorResponse(t,new Error("Attach requests are not supported")),this.shutdown()}launchRequest(i,s){return e(this,void 0,void 0,function*(){let n={};if(s.pathMappings)for(const e of Object.keys(s.pathMappings)){const i=s.pathMappings[e],r=S.resolve(this.workspaceFolder,i),o=t.Uri.file(e).toString(!0);Ze.isAbsolute(e)||t.window.showErrorMessage("Path mapping '{mappedServerPath}' is not absolute"),n[o]=r}s.localSourceRoot&&s.serverSourceRoot&&(n[s.serverSourceRoot]=s.localSourceRoot),s.pathMappings=n,this.ft=s;const o=e=>{this.sendEvent(new r.OutputEvent(Qt.inspect(e)+"\n")),"ENOENT"==e.code&&(t.window.showErrorMessage("The `php` command cannot be found. Please verify that PHP is installed, or change `php.executablePath` setting."),this.sendEvent(new r.TerminatedEvent))},h=()=>e(this,void 0,void 0,function*(){D.client.trackEvent({name:"debug started",properties:{}}),yield new Promise((t,e)=>Yt.access(s.program,Yt.constants.pt,i=>i?e(i):t()));var t=s.runtimeArgs||[];const e=si.u(s.runtimeExecutable),i=s.args||[],n=s.cwd||this.workspaceFolder,h=s.env||process.env;if(t=t.concat(this.yt(s)),s.externalConsole){(yield ti.Terminal.launchInTerminal(n,[e,...t,s.program,...i],h)).on("exit",()=>{this.sendEvent(new r.TerminatedEvent)})}else{const c=Zt.spawn(e,[...t,s.program,...i],{cwd:n,env:h});c.stdout.on("data",t=>{this.sendEvent(new r.OutputEvent(t+"","stdout"))}),c.stderr.on("data",t=>{this.sendEvent(new r.OutputEvent(t+"","stderr"))}),c.on("exit",()=>{this.sendEvent(new r.OutputEvent("")),this.sendEvent(new r.TerminatedEvent)}),c.on("error",o),this.wt=c}}),c=()=>e(this,void 0,void 0,function*(){var t=s.runtimeArgs||[];const e=si.u(s.runtimeExecutable),i=s.cwd||this.workspaceFolder,n=s.env||process.env;t=t.concat(this.yt(s)),this.sendEvent(new r.OutputEvent('Launching "'+e+'" ...\n',"stdout"));const h=Zt.spawn(e,[...t],{cwd:i,env:n});h.stdout.on("data",t=>{this.sendEvent(new r.OutputEvent(t+"","stdout"))}),h.stderr.on("data",t=>{this.sendEvent(new r.OutputEvent(t+"","stdout"))}),h.on("exit",()=>{this.sendEvent(new r.TerminatedEvent)}),h.on("error",o),h.on("message",t=>{this.sendEvent(new r.OutputEvent(t+"","stdout"))}),this.sendEvent(new r.OutputEvent("PHP Development Server"));let c=t.indexOf("-S");c>=0&&c+1<t.length&&this.sendEvent(new r.OutputEvent("Listening on http://"+t[c+1]+"\n","stdout"));var a=(c=t.indexOf("-t"))>=0&&c+1<t.length?t[c+1]:".";a=Ze.isAbsolute(a)?a:Ze.resolve(this.workspaceFolder,a),this.sendEvent(new r.OutputEvent('Document root is "'+a+'"\n',"stdout")),this.wt=h});null!=s.dbgpProxy&&s.dbgpProxy.enable&&(yield this.bt(s.dbgpProxy.host,s.dbgpProxy.port,s.dbgpProxy.ideKey||w.userInfo().username,s.port||9e3));const a=()=>new Promise((t,n)=>{const o=this.q=Ut.createServer();o.on("connection",t=>e(this,void 0,void 0,function*(){try{const i=new Nt.Connection(t);s.log&&this.sendEvent(new r.OutputEvent("new connection "+i.id+"\n"),!0),this.tt.set(i.id,i),this.et.add(i);const n=t=>{this.tt.has(i.id)&&(s.log&&this.sendEvent(new r.OutputEvent("connection "+i.id+" closed\n")),t&&this.sendEvent(new r.OutputEvent("connection "+i.id+": "+t.message+"\n")),this.sendEvent(new r.ThreadEvent("exited",i.id)),i.close(),this.tt.delete(i.id),this.et.delete(i))};i.on("warning",t=>{this.sendEvent(new r.OutputEvent(t+"\n"))}),i.on("error",n),i.on("close",n),i.on("before-execute-command",()=>{this.sendEvent(new r.ContinuedEvent(i.id))}),yield i.waitForInitPacket();try{var e=s.XdebugSettings||{};e.max_children=100,e.max_data=8192,yield Promise.all(Object.keys(e).map(t=>i.sendFeatureSetCommand(t,e[t])))}catch(t){throw new Error("Error applying XdebugSettings: "+(t instanceof Error?t.message:t))}this.sendEvent(new r.ThreadEvent("started",i.id)),yield this.sendEvent(new r.InitializedEvent)}catch(t){this.sendEvent(new r.OutputEvent((t instanceof Error?t.message:t)+"\n","stderr")),this.shutdown()}})),o.on("error",t=>{this.sendEvent(new r.OutputEvent(Qt.inspect(t)+"\n")),this.sendErrorResponse(i,t)}),o.listen(s.port||9e3,e=>e?n(e):t()),this.sendEvent(new r.OutputEvent("Listening to Xdebug on port "+(s.port||9e3)+" ...\n"))});try{s.noDebug||(yield a()),s.runtimeArgs&&s.runtimeArgs.indexOf("-S")>=0?yield c():s.program&&(yield h())}catch(t){return void this.sendErrorResponse(i,t)}this.sendResponse(i)})}yt(t){return["-dxdebug.remote_enable=1","-dxdebug.remote_handler=dbgp","-dxdebug.remote_mode=req","-dxdebug.remote_host=127.0.0.1","-dxdebug.remote_port="+(t.port||9e3),"-dxdebug.remote_autostart=1"]}bt(t,i,s,n){return e(this,void 0,void 0,function*(){this.gt=new ni.DbgpProxyHandler(t,i,s,n),this.gt.on("info",t=>{this.sendEvent(new r.OutputEvent(t+"\n","stdout"))}),this.gt.on("error",t=>{this.sendEvent(new r.OutputEvent(t.message+"\n","stderr"))}),yield this.gt.Register()})}qt(){return e(this,void 0,void 0,function*(){null!=this.gt&&(yield this.gt.Unregister())})}Et(t){return e(this,void 0,void 0,function*(){const i=t.connection;if(this.ot.set(i,t),"stopping"===t.status){const t=yield i.sendStopCommand();this.Et(t)}else if("stopped"===t.status)this.tt.delete(i.id),this.sendEvent(new r.ThreadEvent("exited",i.id)),i.close();else if("break"===t.status){let a,d;if(t.exception){if(this.checkIfExcluded(t.fileUri)){const t=yield i.sendRunCommand();return void(yield this.Et(t))}a="exception",d=t.exception.name+": "+t.exception.message}else if(this.ft.stopOnEntry)a="entry";else if(0===t.command.indexOf("step")){a="step";const e=t.command;if(this.checkIfExcluded(t.fileUri)){const t=yield i.sendStepCommand(e);return void(yield this.Et(t))}}else{var s=t.fileUri.toLowerCase();if(this.vt.has(s)){var n=this.vt.get(s),o=t.line;if(n.has(o)){var h=n.get(o);yield this.languageServer.onReady();var c=yield k.replaceTopCurlyBraces(h.logMessage,t=>e(this,void 0,void 0,function*(){return yield this.languageServer.sendRequest("devsense/validateExpression",{expression:t}).then(()=>e(this,void 0,void 0,function*(){var e=(yield i.sendEvalCommand(t)).result;return e?ri(e):"no result"}),t=>t.message)}));this.sendEvent(new r.OutputEvent(c+"\n"));const t=yield i.sendRunCommand();return void(yield this.Et(t))}}else a="breakpoint"}const u=new r.StoppedEvent(a,i.id,d);u.body.allThreadsStopped=!1,this.sendEvent(u)}})}checkIfExcluded(t){return this.ft.exclude&&this.ft.exclude.some(e=>ii(ei.xt(t).replace(/\\/g,"/"),e))}dispatchRequest(t){if(this.ft&&this.ft.log){const e=`-> ${t.command}Request\n${Qt.inspect(t,{depth:1/0})}\n\n`;super.sendEvent(new r.OutputEvent(e))}super.dispatchRequest(t)}sendEvent(t,e=!1){if(this.ft&&this.ft.log&&!e){const e=`<- ${t.event}Event\n${Qt.inspect(t,{depth:1/0})}\n\n`;super.sendEvent(new r.OutputEvent(e))}super.sendEvent(t)}sendResponse(t){if(this.ft&&this.ft.log){const e=`<- ${t.command}Response\n${Qt.inspect(t,{depth:1/0})}\n\n`;super.sendEvent(new r.OutputEvent(e))}super.sendResponse(t)}sendErrorResponse(t){if(arguments[1]instanceof Error){const e=arguments[1],i=arguments[2];let s;s="number"==typeof e.code?e.code:"number"==typeof e.errno?e.errno:0,super.sendErrorResponse(t,s,e.message,i)}else super.sendErrorResponse(t,arguments[1],arguments[2],arguments[3],arguments[4])}setBreakPointsRequest(t,i){return e(this,void 0,void 0,function*(){try{const o=ei.Rt(i.source.path,this.ft.pathMappings),h=Array.from(this.tt.values());let c,a;if(t.body={breakpoints:[]},0===h.length)a=i.breakpoints.map(t=>({verified:!1,line:t.line}));else{a=[],c=i.breakpoints.map(t=>t.condition?new Nt.ConditionalBreakpoint(t.condition,o,t.line,t.logMessage):new Nt.LineBreakpoint(o,t.line,t.logMessage));var s=o.toLowerCase(),n=new Map;this.vt.set(s,n),c.filter(t=>(t instanceof Nt.ConditionalBreakpoint||t instanceof Nt.LineBreakpoint)&&ei.Pt(o,t.fileUri)&&null!=t.logMessage).map(t=>{n.has(t.line)||n.set(t.line,t)}),yield Promise.all(h.map((t,i)=>e(this,void 0,void 0,function*(){const i=(()=>e(this,void 0,void 0,function*(){const{breakpoints:i}=yield t.sendBreakpointListCommand();yield Promise.all(i.filter(t=>t instanceof Nt.LineBreakpoint&&ei.Pt(o,t.fileUri)).map(t=>t.remove())),yield Promise.all(c.map((i,s)=>e(this,void 0,void 0,function*(){try{yield t.sendBreakpointSetCommand(i),a[s]={verified:!0,line:i.line}}catch(t){a[s]={verified:!1,line:i.line,message:t.message}}})))}))();t.isPendingExecuteCommand?i.catch(t=>this.sendEvent(new r.OutputEvent(Qt.inspect(t)+"\n"))):yield i})))}t.body={breakpoints:a}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}setExceptionBreakPointsRequest(t,i){return e(this,void 0,void 0,function*(){try{const s=Array.from(this.tt.values());yield Promise.all(s.map(t=>e(this,void 0,void 0,function*(){const s=(()=>e(this,void 0,void 0,function*(){const{breakpoints:e}=yield t.sendBreakpointListCommand();yield Promise.all(e.filter(t=>"exception"===t.type).map(t=>t.remove())),yield Promise.all(i.filters.map(e=>t.sendBreakpointSetCommand(new Nt.ExceptionBreakpoint(e))))}))();t.isPendingExecuteCommand?s.catch(t=>this.sendEvent(new r.OutputEvent(Qt.inspect(t)+"\n"))):yield s})))}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}setFunctionBreakPointsRequest(t,i){return e(this,void 0,void 0,function*(){try{const s=Array.from(this.tt.values());let n;0===s.length?n=i.breakpoints.map(t=>({verified:!1,message:"No connection"})):(n=[],yield Promise.all(s.map((t,s)=>e(this,void 0,void 0,function*(){const s=(()=>e(this,void 0,void 0,function*(){const{breakpoints:s}=yield t.sendBreakpointListCommand();yield Promise.all(s.filter(t=>"call"===t.type).map(t=>t.remove())),yield Promise.all(i.breakpoints.map((i,s)=>e(this,void 0,void 0,function*(){try{yield t.sendBreakpointSetCommand(new Nt.CallBreakpoint(i.name,i.condition)),n[s]={verified:!0}}catch(t){n[s]={verified:!1,message:t instanceof Error?t.message:t}}})))}))();t.isPendingExecuteCommand?s.catch(t=>this.sendEvent(new r.OutputEvent(Qt.inspect(t)+"\n"))):yield s})))),t.body={breakpoints:n}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}configurationDoneRequest(t,i){return e(this,void 0,void 0,function*(){let e=[];try{e=yield Promise.all(Array.from(this.et).map(t=>(this.et.delete(t),this.ft.stopOnEntry?t.sendStepIntoCommand():t.sendRunCommand())))}catch(i){this.sendErrorResponse(t,i);for(const t of e)this.Et(t);return}this.sendResponse(t);for(const t of e)this.Et(t)})}threadsRequest(t){const e=Array.from(this.tt.values());t.body={threads:e.map(t=>new r.Thread(t.id,`Request ${t.id} (${Vt(t.timeEstablished).format("LTS")})`))},this.sendResponse(t)}stackTraceRequest(t,i){return e(this,void 0,void 0,function*(){try{const e=this.tt.get(i.threadId);if(!e)throw new Error("Unknown thread ID");const{stack:s}=yield e.sendStackGetCommand(),n=this.ot.get(e);if(0===s.length&&n&&n.exception){const i=this.ot.get(e),s=this.nt++,n=i.exception.name;let r,o=i.line;const h=Wt.parse(i.fileUri);if("dbgp:"===h.protocol){const t=this.it++;this.st.set(t,{connection:e,url:i.fileUri}),r={name:i.exception.name+".php",sourceReference:t,origin:i.exception.name},o++}else{const t=ei.xt(h.href,this.ft.pathMappings);r={name:Ze.basename(t),path:t}}this.ct.set(s,i),t.body={stackFrames:[{id:s,name:n,source:r,line:o,column:1}]}}else t.body={stackFrames:s.map(t=>{let i,s=t.line;const n=Wt.parse(t.fileUri);if("dbgp:"===n.protocol){const n=this.it++;this.st.set(n,{connection:e,url:t.fileUri}),i={name:"eval"===t.type?"eval.php":t.name,sourceReference:n,origin:t.type},s++}else{const t=ei.xt(n.href,this.ft.pathMappings);i={name:Ze.basename(t),path:t}}const r=this.nt++;return this.rt.set(r,t),{id:r,name:t.name,source:i,line:s,column:1}})}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}sourceRequest(t,i){return e(this,void 0,void 0,function*(){try{if(!this.st.has(i.sourceReference))throw new Error(`Unknown sourceReference ${i.sourceReference}`);const{connection:e,url:s}=this.st.get(i.sourceReference);let{source:n}=yield e.sendSourceCommand(s);/^\s*<\?(php|=)/.test(n)||(n="<?php\n"+n),t.body={content:n,mimeType:"application/x-php"}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}scopesRequest(t,i){return e(this,void 0,void 0,function*(){try{let e=[];if(this.ct.has(i.frameId)){const t=this.ct.get(i.frameId);if(t.exception){const i=this.ht++;this.at.set(i,t),e=[new r.Scope(t.exception.name.replace(/^(.*\\)+/g,""),i)]}}else{const t=this.rt.get(i.frameId);if(!t)throw new Error(`Unknown frameId ${i.frameId}`);e=(yield t.getContexts()).map(t=>{const e=this.ht++;return this.dt.set(e,t),new r.Scope(t.name,e)});const s=this.ot.get(t.connection);if(s&&s.exception){const t=this.ht++;this.at.set(t,s),e.unshift(new r.Scope(s.exception.name.replace(/^(.*\\)+/g,""),t))}}t.body={scopes:e}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}variablesRequest(t,i){return e(this,void 0,void 0,function*(){try{const n=i.variablesReference;let o;if(this.at.has(n)){const t=this.at.get(n);o=[new r.Variable("type",t.exception.name),new r.Variable("message",'"'+t.exception.message+'"')],void 0!==t.exception.code&&o.push(new r.Variable("code",t.exception.code+""))}else{let t;if(this.dt.has(n)){t=yield this.dt.get(n).getProperties()}else if(this.ut.has(n)){const e=this.ut.get(n);if(e.hasChildren)if(e.children.length===e.numberOfChildren)t=e.children;else{var s=-1;"indexed"==i.filter&&(s=i.start/i.count),t=yield e.getChildren(s)}else t=[]}else{if(!this.lt.has(n))throw new Error("Unknown variable reference");{const e=this.lt.get(n);t=e.hasChildren?e.children:[]}}yield Promise.all(t.map(t=>e(this,void 0,void 0,function*(){t instanceof Nt.Property&&(yield t.ensureCompleteString())}))),o=t.map(t=>{const e=ri(t);let i,s;t.hasChildren||"array"===t.type||"object"===t.type?(i=this.ht++,t instanceof Nt.Property?this.ut.set(i,t):t instanceof Nt.EvalResultProperty&&this.lt.set(i,t)):i=0,s=t instanceof Nt.Property?t.fullName:t.name;let n=null;return"array"==t.type&&(n=t.numberOfChildren),{name:t.name,value:e,type:t.type,indexedVariables:n,variablesReference:i,evaluateName:s}})}t.body={variables:o}}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t)})}continueRequest(t,i){return e(this,void 0,void 0,function*(){let e;try{const s=this.tt.get(i.threadId);if(!s)throw new Error("Unknown thread ID "+i.threadId);e=yield s.sendRunCommand()}catch(i){return this.sendErrorResponse(t,i),void(e&&this.Et(e))}t.body={allThreadsContinued:!1},this.sendResponse(t),this.Et(e)})}nextRequest(t,i){return e(this,void 0,void 0,function*(){let e;try{const s=this.tt.get(i.threadId);if(!s)throw new Error("Unknown thread ID "+i.threadId);e=yield s.sendStepOverCommand()}catch(i){return this.sendErrorResponse(t,i),void(e&&this.Et(e))}this.sendResponse(t),this.Et(e)})}stepInRequest(t,i){return e(this,void 0,void 0,function*(){let e;try{const s=this.tt.get(i.threadId);if(!s)throw new Error("Unknown thread ID "+i.threadId);e=yield s.sendStepIntoCommand()}catch(i){return this.sendErrorResponse(t,i),void(e&&this.Et(e))}this.sendResponse(t),this.Et(e)})}stepOutRequest(t,i){return e(this,void 0,void 0,function*(){let e;try{const s=this.tt.get(i.threadId);if(!s)throw new Error("Unknown thread ID "+i.threadId);e=yield s.sendStepOutCommand()}catch(i){return this.sendErrorResponse(t,i),void(e&&this.Et(e))}this.sendResponse(t),this.Et(e)})}pauseRequest(t,e){this.sendErrorResponse(t,new Error("Pausing the execution is not supported by Xdebug"))}disconnectRequest(t,i){return e(this,void 0,void 0,function*(){try{yield Promise.all(Array.from(this.tt).map(([t,i])=>e(this,void 0,void 0,function*(){yield Promise.race([i.sendStopCommand(),new Promise(t=>setTimeout(t,500))]),yield i.close(),this.tt.delete(t),this.et.delete(i)}))),this.q&&(yield new Promise(t=>this.q.close(t))),this.wt&&this.wt.kill(),this.gt&&(yield this.qt())}catch(e){return void this.sendErrorResponse(t,e)}this.sendResponse(t),this.shutdown()})}IsAutoGlobalVariableName(t){switch(t){case this.GlobalsName:case this.ServerName:case this.EnvName:case this.CookieName:case this.HttpRawPostDataName:case this.FilesName:case this.RequestName:case this.GetName:case this.PostName:case this.SessionName:return!0;default:return!1}}IsSimpleExpression(t){return null!=t.match(/^\$[a-zA-Z_][a-zA-Z0-9_]*((\-\>[a-zA-Z_][a-zA-Z0-9_]*)|(\[["']?[a-zA-z0-9]+["']?\]))*$/)}evaluateRequest(t,i){return e(this,void 0,void 0,function*(){this.languageServer.onReady().then(()=>{this.languageServer.sendRequest("devsense/validateExpression",{expression:i.expression}).then(s=>e(this,void 0,void 0,function*(){if("hover"!=i.context||!i.expression.match(/^[a-zA-Z0-9_]*$/))try{if(!i.frameId)throw new Error("Cannot evaluate code without a connection");if(!this.rt.has(i.frameId))throw new Error(`Unknown frameId ${i.frameId}`);var e=this.rt.get(i.frameId);const r=e.connection;var s;if(this.IsSimpleExpression(i.expression)){var n=this.IsAutoGlobalVariableName(i.expression)?1:0;const t=(yield r.sendPropertyGetCommand(i.expression,e,n)).result;t&&(yield t.ensureCompleteString()),s=t}else s=(yield r.sendEvalCommand(i.expression)).result;if(s){const e=ri(s);let i;s.hasChildren||"array"===s.type||"object"===s.type?(i=this.ht++,s instanceof Nt.Property?this.ut.set(i,s):this.lt.set(i,s)):i=0;let n=null;"array"==s.type&&(n=s.numberOfChildren),t.body={result:e,indexedVariables:n,variablesReference:i}}else t.body={result:"no result",variablesReference:0};this.sendResponse(t)}catch(e){this.sendErrorResponse(t,e)}}),e=>{i.context&&"hover"==i.context||(t.body={result:e.message,variablesReference:0},this.sendResponse(t))})})})}setVariableRequest(t,i){return e(this,void 0,void 0,function*(){try{var e;if(this.dt.has(i.variablesReference)){var s=this.dt.get(i.variablesReference).stackFrame;e=(yield s.connection.SendPropertySetCommand(i.name,i.value,s,0)).success}else if(this.ut.has(i.variablesReference)){var n=this.ut.get(i.variablesReference);const t=n.frame.connection;var r=(yield n.getChildren()).find(t=>t.name==i.name);e=(yield t.SendPropertySetCommand(r.fullName,i.value,r.frame,0)).success}t.success=e,e&&(t.body={value:i.value}),this.sendResponse(t)}catch(e){this.sendErrorResponse(t,e)}})}setExpressionRequest(t,i){return e(this,void 0,void 0,function*(){})}}exports.PhpDebugSession=oi;