"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const r=require("vscode"),os=require("./tree/state"),is=require("./stateDecorationTypes"),i=require("./util");class rs{constructor(t,s){this.testExplorer=s,this.stateDecorationTypes=new is.StateDecorationTypes(t,this.testExplorer.iconPaths),this.errorDecorationType=r.window.createTextEditorDecorationType({backgroundColor:"rgba(255,0,0,0.3)",isWholeLine:!0,overviewRulerColor:"rgba(255,0,0,0.3)"}),t.subscriptions.push(this.errorDecorationType),t.subscriptions.push(r.window.onDidChangeActiveTextEditor(t=>{this.activeTextEditor=t,this.updateDecorationsNow()})),this.activeTextEditor=r.window.activeTextEditor}updateDecorationsFor(t){!this.timeout&&this.activeTextEditor&&this.activeTextEditor.document.fileName===t&&(this.timeout=setTimeout(()=>this.updateDecorationsNow(),200))}updateDecorationsNow(){if(this.timeout=void 0,!this.activeTextEditor)return;const t=this.activeTextEditor.document.fileName,s=new Map;for(const t of this.stateDecorationTypes.all)s.set(t,[]);s.set(this.errorDecorationType,[]);for(const o of this.testExplorer.collections)this.addStateDecorations(o,t,s),this.addErrorDecorations(o,t,s);for(const[t,o]of s)this.activeTextEditor.setDecorations(t,o)}addStateDecorations(t,s,o){if(t.shouldShowGutterDecoration()){const e=t.getLocatedNodes(s);if(e)for(const[t,s]of e){let e;e=1===s.length?os.stateIcon(s[0].state):os.stateIcon(os.parentNodeState(s));const i=this.stateDecorationTypes[e];o.get(i).push({range:new r.Range(t,0,t,0)})}}}addErrorDecorations(t,s,o){if(t.shouldShowErrorDecoration()&&t.suite)for(const e of i.allTests(t.suite))if(e.info.file===s)for(const t of e.decorations)o.get(this.errorDecorationType).push({range:new r.Range(t.line,0,t.line,0),renderOptions:{after:{contentText:` // ${t.message}`}}})}}exports.Decorator=rs;